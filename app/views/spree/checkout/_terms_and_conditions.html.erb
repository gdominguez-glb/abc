<div class="terms_and_conditions_box">
  <h4><%= Spree.t('terms_and_conditions.title') %></h4>

  <div class="terms_and_conditions_text">
    <% @current_order.products.select{|p| p.license_text.present?}.each do |product| %>
      <h5><%= product.name %></h5>
      <p>
        <%= simple_format product.license_text %>
      </p>
    <% end %>
  </div>

  <div class="margin-top-s">
    <%= form.check_box :terms_and_conditions %> <%= label_tag(:terms_and_conditions, Spree.t('terms_and_conditions.checkbox')) %>
  </div>
</div>
<%= button_tag Spree.t(:save_and_continue), :class => 'continue btn btn-success btn-block-xs disabled term-continue-button margin-bottom' %>
<div class="alert alert-info"><i class="mi">info_outline</i> Scroll through and accept the terms to continue.</div>

<script type="text/javascript">
  $(function(){
    var scrolledToBottom = false;
    var agreedTerms = false;
    $('input[name="order[terms_and_conditions]"]').change(function(){
      agreedTerms = $(this).is(':checked');
      activateContinueButton();
    });

    if($('.terms_and_conditions_text').get(0).scrollHeight == ($('.terms_and_conditions_text').height() + 40)) {
      setTimeout(function() {
        scrolledToBottom = true;
        activateContinueButton();
      }, 3000)
    } else {
      $('.terms_and_conditions_text').scroll(function () {
        if (($(this).scrollTop() + 40) == $(this).get(0).scrollHeight - $(this).height()) {
          scrolledToBottom = true;
          activateContinueButton();
        }
      });
    }

    function activateContinueButton() {
      if(scrolledToBottom && agreedTerms) {
        $('.term-continue-button').removeClass('disabled');
      } else {
        $('.term-continue-button').addClass('disabled');
      }
    }
  })
</script>
