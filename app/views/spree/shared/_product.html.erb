<% url = spree.product_url(product, taxon_id: @taxon.try(:id)) %>
<div id="product_<%= product.id %>" class="col-md-6 product-list-item" data-hook="products_list_item" itemscope itemtype="http://schema.org/Product">
  <div class="product-wrapper">
    <% cache(@taxon.present? ? [I18n.locale, current_currency, @taxon, product] : [I18n.locale, current_currency, product]) do %>
      <div class="product-body flip-container">
        <div class="flipper">
          <div class="flip-front">
            <h5 class="title">
              <% if product.group_product? %>
                <%= link_to truncate(product.name, length: 50), group_product_path(product), itemprop: "name", title: product.name %>
              <% else %>
                <%= link_to truncate(product.name, length: 50), url, itemprop: "name", title: product.name %>
              <% end %>
            </h5>
            <button class="btn btn-link flip-btn">
              More
            </button>
          </div>
          <div class="flip-back">
            <p><%= truncate product.short_description %></p>
            <button class="btn btn-link flip-btn">
              Back
            </button>
          </div>
        </div>
      </div>
      <div class="product-footer">
        <span class="product-type"><%= product.curriculum.try(:name) || 'General' %></span>
        <% if product.group_product? %>
          <%= link_to 'Explore', group_product_path(product), class: 'pull-right' %>
        <% elsif product.partner_product? && product.redirect_url.present? %>
          <%= link_to 'Visit Partner Site', product.redirect_url, class: 'pull-right', target: '_blank' %>
        <% else %>
          <span itemprop="offers" itemscope itemtype="http://schema.org/Offer" class="product-price pull-right">
            <span class="price selling" itemprop="price"><%= link_to display_price(product), url, class: 'btn btn-sm btn-primary' %></span>
          </span>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
