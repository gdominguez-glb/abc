<fieldset id="password-credentials">
  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <label>First Name</label>
        <%= f.text_field :first_name, :class => 'form-control', :placeholder => Spree.t(:first_name), tabindex: 1 %>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-group">
        <label>Last Name</label>
        <%= f.text_field :last_name, :class => 'form-control', :placeholder => Spree.t(:last_name), tabindex: 2 %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <label>Email Address</label>
        <% f.object.email ||= params[:email] %>
        <%= f.email_field :email, :class => 'form-control', :placeholder => Spree.t(:email), tabindex: 3 %>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-group">
        <label>Password</label>
        <%= f.password_field :password, :class => 'form-control', :placeholder => Spree.t(:password), tabindex: 4 %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <label><%= f.check_box :allow_communication %> Receive Newsletter and updates </label>
      </div>
    </div>
    <% if Rails.env.production? %>
      <div class="col-md-6">
        <div class="form-group">
          <label>Beta Password</label>
          <%= f.password_field :beta_password, :class => 'form-control' %>
        </div>
      </div>
    <% end %>
  </div>
  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <label>Subjects you are interested in</label>
        <%= f.collection_select :interested_subjects, Curriculum.visibles, :id, :name, { include_hidden: false, multiple: true }, { class: 'form-control', tabindex: 5, multiple: 'multiple' } %>
      </div>
    </div>
    <div class="col-md-6">
      <label>Role</label>
      <div class="form-group select-container dark-select block">
        <span>Select your Role</span>
        <%= f.select :title, options_for_select(USER_TITLES, f.object.title), { prompt: 'Please select your role' }, { class: 'form-control', tabindex: 6 } %>
      </div>
    </div>
  </div>
  <div class="row hide" id="phone-field">
    <div class="col-md-6">
      <div class="form-group">
        <label>Phone</label>
        <%= f.text_field :phone, class: 'form-control' %>
      </div>
    </div>
  </div>
  <hr />
</fieldset>

<div class="school-district-details collapse">
  <h2>Let's get some specifics about your school</h2>

  <% selected_place_type = params[:spree_user].try(:[], :school_district_attributes).try(:[], :place_type) %>
  <% f.object.school_district ||= SchoolDistrict.new(place_type: (selected_place_type || 'school')) %>

  <div id="schoolDistrictSelect">
    <p>Is this a school or a district?</p>
    <div class="form-group">
      <div class="radio">
        <%= f.fields_for :school_district do |school_district_form| %>
          <label>
            <%= school_district_form.radio_button :place_type, 'school' %>
            This is a School
          </label>
          <label>
            <%= school_district_form.radio_button :place_type, 'district' %>
            This is Multiple Schools/District
          </label>
        <% end %>
      </div>
    </div>
  </div>


  <% us_country = Spree::Country.find_by(iso: 'US') %>

  <% selected_country_id = params[:spree_user].try(:[], :school_district_attributes).try(:[], :country_id) || us_country.id %>
  <% selected_country = Spree::Country.find_by(id: selected_country_id) %>

  <div class="row">
    <div class="col-md-6">
      <label>Country</label>
      <div class="form-group school-district select-container dark-select block">
        <span><%= selected_country.name %></span>
        <%= f.fields_for :school_district do |school_district_form| %>
          <%= school_district_form.collection_select :country_id, Spree::Country.all, :id, :name, { selected: selected_country_id  } , { class: 'form-control' } %>
        <% end %>
      </div>
    </div>
  </div>

  <% us_selected = (selected_country_id.to_i == us_country.id) %>
  <div id="state-input-wrapper" class="row <%= 'hide' if !us_selected %>">
    <div class="col-md-6">
      <label>State</label>
      <div class="form-group school-district select-container dark-select block">
        <% selected_state_id = params[:spree_user].try(:[], :school_district_attributes).try(:[], :state_id) %>
        <% selected_state_name = Spree::State.find_by(id: selected_state_id).try(:name) %>
        <span><%= selected_state_name ? selected_state_name : 'Select a State' %></span>
        <%= f.fields_for :school_district do |school_district_form| %>
          <%= school_district_form.collection_select :state_id, us_country.states, :id, :name, { prompt: true, selected: selected_state_id  } , { class: 'form-control', disabled: !us_selected } %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <label>City (Optional)</label>
        <%= f.fields_for :school_district do |school_district_form| %>
          <%= school_district_form.text_field :city, class: 'form-control' %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="row collapse <%= 'in' if f.object.school_district.place_type == 'district' %> fade" id="rowDistrictSelect">
    <div class="col-md-6">
      <div class="form-group">
        <label>Select a District</label>
        <%= f.hidden_field :district_id, class: 'form-control' %>
      </div>
    </div>
  </div>

  <div class="row collapse <%= 'in' if f.object.school_district.place_type == 'school' %>  fade" id="rowSchoolSelect">
    <div class="col-md-6">
      <div class="form-group">
        <label>Select a School</label>
        <%= f.hidden_field :school_id, class: 'form-control' %>
      </div>
    </div>
  </div>

  <div class="input-group add-district-field collapse fade" id="rowAddDistrict">
    <%= f.fields_for :school_district do |school_district_form| %>
      <%= school_district_form.text_field :name, class: 'form-control school-district-control', placeholder: 'New District Name' %>
    <% end %>
    <span class="input-group-btn">
      <button type="button" class="btn btn-danger" id="closeAddDistrict"><i class="mi">close</i></button>
    </span>
  </div>

  <div class="input-group add-school-field collapse fade" id="rowAddSchool">
    <% f.object.school_district ||= SchoolDistrict.new(place_type: 'school') %>
    <%= f.fields_for :school_district do |school_district_form| %>
      <%= school_district_form.text_field :name, class: 'form-control school-district-control', placeholder: 'New School Name' %>
    <% end %>
    <span class="input-group-btn">
      <button type="button" class="btn btn-danger" id="closeAddSchool"><i class="mi">close</i></button>
    </span>
  </div>

</div>
<div data-hook="signup_below_password_fields"></div>

<script type="text/javascript">
  window.us_country_id = '<%= us_country.id %>';
  var schoolData = [{id: '#schoolNotListed', text: 'School Not Listed'}].concat(<%= raw school_district_selection_data(SchoolDistrict.for_selection.school).to_json %>);
  var districtData = [{id: '#districtNotListed', text: 'District Not Listed'}].concat(<%= raw school_district_selection_data(SchoolDistrict.for_selection.district).to_json %>);
</script>
