<%= render partial: 'tabs', locals: { tab: 'users' } %>

<div class="container">
  <div class="text-center">
    <h2>Need to transfer a license, or just checking in ...</h2>
    <h6>Here is where you can remind, reassign, and revoke user licenses</h6>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th><input type="checkbox" /></th>
        <th>User</th>
        <th>School/District</th>
        <th>Product</th>
        <th>Last Active</th>
        <th colspan='4'></th>
      </tr>
    </thead>
    <tbody>
      <% @users.each do |user| %>
        <tr data-user-id='<%= user.id %>'>
          <td><input type="checkbox" /></td>
          <td><%= user.full_name %></td>
          <td><%= user.school_district.try(:name) %></td>
          <td><%= user.products.map(&:name).join(', ') %></td>
          <td><%= user.last_sign_in_at.strftime("%b %-d, %Y") %></td>
          <td>
            <%= link_to 'Remind', new_account_reminder_path(email: user.email), class: 'btn btn-primary btn-sm', remote: true %>
          </td>
          <td>
            <%= link_to 'Reassign', reassign_modal_account_licenses_path(from_user_id: user.id), class: 'btn btn-primary btn-sm', remote: true %>
          </td>
          <td>
            <a href="<%= user_stats_account_licenses_path(user_id: user.id)  %>" class="btn btn-primary btn-sm user-details-btn">Details</a>
          </td>
          <td>
            <%= link_to 'Revoke', revoke_modal_account_licenses_path(revoke_user_id: user.id), class: 'btn btn-default btn-sm', remote: true %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <%= paginate @users %>
</div>
<%= content_for :javascripts do %>
  <%= javascript_tag do %>
    $(function() {
      $('.user-details-btn').click(function(e){
        e.preventDefault();
        var $tr = $(this).parents('tr');
        var user_id = $tr.attr('data-user-id');
        var url = $(this).attr('href');
        var $user_tr = $("#user-stats-tr-"+user_id);
        if ($user_tr.length > 0) {
          $user_tr.remove()
        } else {
          $.get(url);
        }
      });
    });
  <% end %>
<% end %>
