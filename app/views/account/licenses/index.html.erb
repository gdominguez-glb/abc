<% content_for :body_class, "licenses" %>

<div class="row">
  <div class="col-sm-10 col-sm-offset-1 margin-top-xl margin-bottom-xl">

    <%= render 'tabs' %>

    <%= form_for @assign_licenses_form, url: assign_account_licenses_path do |f| %>
      <div class="page-header margin-top-xl">
        <h2 class="margin-bottom-m">Ready to assign some licenses...</h2>
        <p class="lead margin-bottom-m">Assign one or more licenses to anyone you want</p>
      </div>
      <% if @assign_licenses_form.errors.count > 0 %>
        <div id="error_explanation" class="alert alert-danger">
          <p>
            OH NO, <%= pluralize(@assign_licenses_form.errors.count, "error") %> prohibited this user from being saved:
          </p>
          <ul>
            <% @assign_licenses_form.errors.full_messages.each do |msg| %>
              <li> <%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <%= render 'stats' %>

      <div class="row margin-bottom-xxl">
        <div class="col-sm-4 border-right-primary min-200 padding-xs-horiz-xl">
          <h4 class="margin-bottom-reset">Step 1.</h4>
          <small class="margin-bottom block"><em>Select product you'd like to assign*</em></small>
          <% selected_option = current_spree_user.managed_products_options.find{|o| o[1] == params[:licenses_ids] } || current_spree_user.managed_products_options.first %>
          <div class="select-container dark-select margin-bottom-reset btn-block-xs">
            <span><%= selected_option[0] %></span>
            <%= select_tag :licenses_ids, options_for_select(current_spree_user.managed_products_options, selected_option[1]), class: 'licenses-select form-control inline-input' %>
          </div>
          <small><em>*This may affect your licenses above</em></small>
        </div>
        <div class="col-sm-4 min-200 padding-xs-horiz-xl">
          <h4 class="margin-bottom-reset">Step 2.</h4>
          <small class="margin-bottom block"><em>Select users you'd like to assign</em></small>
          <%= link_to 'Add Users', select_users_account_licenses_path, class: 'btn btn-primary btn-block margin-bottom', remote: true %>
          <%= f.text_field :licenses_recipients, class: 'form-control hidden', placeholder: 'Enter email addresses, separated by commas' %>
        </div>
        <div class="col-sm-4 border-left-primary min-200 padding-xs-horiz-xl">
          <h4 class="margin-bottom-reset">Step 3.</h4>
          <small class="margin-bottom block"><em>Select the quantity of licenses to assign</em></small>
          <div class="row">
            <div class="col-sm-6">
              <div class="form-group margin-bottom-s">
                <label for="">License Quantity</label>
                <%= f.number_field :licenses_number, class: 'form-control', value: 1 %>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label for="">Number of Users</label>
                <%= f.text_field :total, class: 'form-control', readonly: true %>
              </div>
            </div>
          </div>
          <strong class="text-uppercase sans-serif">Total Licenses = <span id="licenseTotal"></span></span>
        </div>
      </div>
      <div class="row text-center license-actions">
        <div class="col-sm-4 col-sm-offset-4">
          <%= f.submit 'Assign License(s)', class: 'btn btn-success btn-block margin-bottom-s disabled', id: 'btnAssignLicenses', data: { disable_with: 'Saving' } %>
        </div>
      </div>
    <% end %>

  </div>
</div>

<%= content_for :javascripts do %>
  <%= render 'assign_form_js' %>
<% end %>
