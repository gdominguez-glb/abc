<%= content_for :body_class, 'without-subnav' if current_spree_user.blank? %>
<div class="row">
  <div class="col-xs-12 margin-bottom-xl">
    <div class="row">
      <div class="col-sm-10 col-sm-offset-1">
        <div class="page-header">
          <h2>Lorem ipsum dolor sit amet</h2>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4 col-md-3 col-lg-2 col-sm-offset-1">
        <%= form_tag '', method: :get, class: 'side-search-form' do %>
          <% params[:taxon_ids].each do |taxon_id| %>
            <%= hidden_field_tag "taxon_ids[]", taxon_id %>
          <% end %>
          <%= text_field_tag :query, params[:query], class: 'form-control margin-bottom', placeholder: 'Search' %>
        <% end %>
        <div class="panel-group" id="categoryFilters" role="tablist" aria-multiselectable="true">
          <%= render 'taxonomies' %>
        </div>
      </div>
      <div class="col-sm-6 col-md-7 col-lg-8 col-lg-offset-halfone">
        <% if @videos.blank? %>
          <div class="video-empty-state">
            <div class="alert alert-warning" role="alert">
              <i class="fa fa-warning"></i> There are no videos that match your request. <strong>Please refine the search settings.</strong>
            </div>
          </div>
        <% else %>
          <div class="row">
            <% @videos.each do |video| %>
              <% if video.is_free? || bought_products?(video.products) %>
                <%= render partial: 'open_video', locals: { video: video } %>
              <% end %>
            <% end %>

            <% @videos.each do |video| %>
              <% if !video.is_free? %>
                <%= render partial: 'locked_video', locals: { video: video } %>
              <% end %>
            <% end %>
          </div>
          <%= paginate @videos %>
        <% end %>
      </div>
    </div>

  </div>
</div>
<%= content_for :javascripts do %>
  <%= javascript_tag do %>
    $(function() {
      $('#categoryFilters .panel-collapse .list-group-item').each(function() {
        if ( $(this).hasClass('active') ) {
          $(this).closest('.panel-collapse').collapse('show');
        }
      });
    });
  <% end %>
<% end %>
