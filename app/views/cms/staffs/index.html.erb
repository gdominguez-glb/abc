<%= render 'cms_nav' %>
<div class="col-md-9">
  <section>
    <h3>Staffs</h3>
    <%= link_to "New Staff", new_cms_staff_path, class: 'btn btn-primary' %>
    <table class="table contact-topics-list">
      <thead>
        <tr>
          <th></th>
          <th>Name</th>
          <th>Titlte</th>
          <th>Display</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @staffs.each do |staff| %>
          <tr data-id="<%= staff.id %>">
            <td><span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span></td>
            <td><%= staff.name %></td>
            <td><%= staff.title %></td>
            <td><%= staff.display? ? 'Yes' : 'No' %></td>
            <td>
              <%= link_to 'Edit', edit_cms_staff_path(staff), class: 'btn btn-default' %>
              <%= link_to 'Delete', cms_staff_path(staff), class: 'btn btn-default', data: { confirm: 'Are you sure?', method: :delete } %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </section>
</div>
<%= content_for :javascripts do %>
  <%= javascript_tag do %>
    function updatePositions() {
      var data = {}
      $.each($(".contact-topics-list tbody tr"), function(index, element) {
        data[$(element).attr('data-id')] = index;
      });
      $.ajax({
        url: '/cms/staffs/update_positions',
        type: 'POST',
        data: { positions: data }
      })
    }
    $(function(){
      $(".contact-topics-list").sortable({
        containerSelector: 'table',
        itemPath: '> tbody',
        itemSelector: 'tr',
        placeholder: '<tr class="placeholder"/>',
        onDrop: function  (item, container, _super) {
          _super(item);
          updatePositions();
        }
      })
    });
  <% end %>
<% end %>
