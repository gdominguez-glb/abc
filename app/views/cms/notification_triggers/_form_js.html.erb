<%= content_for :javascripts do %>
  <%= javascript_tag do %>
    $(function(){
      var url = "<%= cms_users_search_path %>";
      var set_users_select = function(selector, multiple) {
        if ($(selector).length > 0) {
          $(selector).select2({
            placeholder: "Select user",
            multiple: multiple,
            initSelection: function (element, callback) {
              return $.getJSON(url, { ids: element.val() }, function (data) {
                return callback(data['users']);
              });
            },
            ajax: {
              url: url,
              datatype: 'json',
              data: function (term, page) {
                return {
                  per_page: 50,
                  page: page,
                  without_children: true,
                  q: term
                };
              },
              results: function (data, page) {
                var more = page < data.pages;
                return {
                  results: data['users'],
                  more: more
                };
              }
            },
            formatResult: function (user) {
              return user.email;
            },
            formatSelection: function (user) {
              return user.email;
            }
          });
        }
      }
      set_users_select($('#notification_trigger_single_user_id'), false);
      set_users_select($('#notification_trigger_user_ids'), true);
      set_users_select($('#notification_trigger_school_district_admin_user_id'), false);
      $('.datetime-picker').datetimepicker({
        format: 'YYYY-MM-DD HH:mm:ss'
      });
      $('#notification_trigger_target_type').change(function(e){
        var target = $(this).val();
        $('.target-input').addClass('hidden');
        $("[data-input='"+ target +"']").removeClass('hidden');
      });
    });
  <% end %>
<% end %>
