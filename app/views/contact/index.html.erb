<% if params[:success] %>
  <div class="alert alert-success">
    Submitted your contact!
  </div>
<% end %>
<div class="row margin-top-xxl margin-bottom-xl">
  <div class="col-sm-8 col-lg-7 col-lg-offset-1">
    <h2>Get in Touch About...</h2>
    <form action="https://cs15.salesforce.com/servlet/servlet.WebToCase?encoding=UTF-8" method="POST" class="form contact-form">
      <input type=hidden name="orgid" value="00De0000005Vrkq">
      <input type=hidden name="retURL" value="<%= contact_url(success: true) %>">
      <div class="row">
        <div class="col-sm-6">
          <label for="topic">Topic</label>
          <div class="select-container dark-select block">
            <span>Select a Topic</span>
            <%= select_tag :topic, options_for_select(@topics), prompt: "Select a Topic", class: 'form-control' %>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6 dependent-field hidden" data-name='Support Type'>
          <label>Support Type</label>
          <div class="select-container dark-select block">
            <span>Support Type</span>
            <%= select_tag :support_type, options_for_select(@supports), prompt: "Select a support type", class: 'form-control' %>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>First Name</label>
            <input maxlength="80" name="First Name" size="20" type="text" class="form-control" placeholder="First Name" required/>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Last Name</label>
            <input maxlength="80" name="Last Name" size="20" type="text" class="form-control" placeholder="Last Name" required/>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Email</label>
            <input maxlength="80" name="Email" size="20" type="text" class="form-control" placeholder="Email" required/>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Phone</label>
            <input maxlength="80" name="Phone" size="20" type="text" class="form-control" placeholder="Phone" required/>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>Role</label>
            <input maxlength="80" name="Role" size="20" type="text" class="form-control" placeholder="Role" required/>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="form-group">
            <label>School or District Type</label>
            <div class="radio">
              <label>
                <input type="radio" name='School or District Type'/> School
              </label>
            </div>
            <div class="radio">
              <label>
                <input type="radio" name='School or District Type' /> District
              </label>
            </div>
          </div>
        </div>

      </div>
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label>School/District</label>
            <input maxlength="80" name="School/District" size="20" type="text" class="form-control" placeholder="School/District" required/>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-6 dependent-field hidden" data-name='Country'>
          <div class="form-group">
            <label>Country</label>
            <input maxlength="80" name="Country" size="20" type="text" class="form-control" placeholder="Country"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="State">
          <div class="form-group">
            <label>State</label>
            <input maxlength="80" name="State" size="20" type="text" class="form-control" placeholder="State"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Curriculum">
          <div class="form-group">
            <label>Curriculum</label>
            <input maxlength="80" name="Curriculum" size="20" type="text" class="form-control" placeholder="Curriculum"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Grade">
          <div class="form-group">
            <label>Grade</label>
            <input maxlength="80" name="Grade" size="20" type="text" class="form-control" placeholder="Grade"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="School or District Size">
          <label>Size</label>
          <div class="select-container dark-select block">
            <span>School or District Size</span>
            <select id="" name="School or District Size" class="form-control">
              <option value="">10+</option>
            </select>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Title 1">
          <div class="form-group">
            <label>Title 1</label>
            <input maxlength="80" name="Title 1" size="20" type="text" class="form-control" placeholder="Title 1"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Returning Customer">
          <div class="form-group">
            <label>Returning Customer</label>
            <input maxlength="80" name="Title 1" size="20" type="text" class="form-control" placeholder="Returning Customer"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Tax Exempt">
          <div class="form-group">
            <label>Tax Exempt</label>
            <input maxlength="80" name="Tax Exempt" size="20" type="text" class="form-control" placeholder="Tax Exempt"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Tax Exempt ID">
          <div class="form-group">
            <label>Tax Exempt ID</label>
            <input maxlength="80" name="Tax Exempt" size="20" type="text" class="form-control" placeholder="Tax Exempt ID"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Desired Dates">
          <div class="form-group">
            <label>Desired Dates</label>
            <input maxlength="80" name="Desired Dates" size="20" type="text" class="form-control" placeholder="Desired Dates"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Desired Training topic">
          <div class="form-group">
            <label>Desired Training topic</label>
            <input maxlength="80" name="Desired Training topic" size="20" type="text" class="form-control" placeholder="Desired Training topic"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Items purchased">
          <div class="form-group">
            <label>Items purchased</label>
            <input maxlength="80" name="Items purchased" size="20" type="text" class="form-control" placeholder="Items purchased"/>
          </div>
        </div>

        <div class="col-sm-6 dependent-field hidden" data-name="Format">
          <div class="form-group">
            <label>Format</label>
            <input maxlength="80" name="Items purchased" size="20" type="text" class="form-control" placeholder="Items purchased"/>
          </div>
        </div>
      </div>

      <div class="row dependent-field hidden" data-name="Description">
        <div class="col-sm-12">
          <div class="form-group">
            <label>Description</label>
            <textarea name="Description" rows="5" class="form-control"></textarea>
          </div>
        </div>
      </div>

      <%# <input type="hidden" name="debug" value=1> %>
      <%# <input type="hidden" name="debugEmail" value="liz.sweet@greatminds.net"> %>
      <%# <div class="form-group"> %>
      <%#   <label for="description">Message</label> %>
      <%#   <textarea name="description" class="form-control" placeholder="Write your message here..."></textarea> %>
      <%# </div> %>
      <input type="hidden" id="external" name="external" value="1" />
      <div class="row">
        <div class="col-md-4 col-md-offset-4">
          <input type="submit" name="submit" class="btn btn-primary btn-block" value="Submit">
        </div>
      </div>
    </form>
  </div>
  <div class="col-sm-4 col-lg-3">
    <ul class="margin-bottom-xl margin-xs-left-xl">
      <li><h6>Great Minds</h6>
      <ul>
        <li>55 M Street SE</li>
        <li>Suite 340</li>
        <li>Washington D.C. 20003</li>
        <li>Phone: 202-223-1854</li>
        <li>Fax: 202-449-9504</li>
      </ul>
      </li>
    </ul>
    <ul class="margin-bottom-xl margin-xs-left-xl">
      <li><h6>Sales Inquiries</h6>
      <ul>
        <li>Phone: 1-844-853-1010</li>
        <li>E-mail: sales@greatminds.net</li>
      </ul>
      </li>
    </ul>
  </div>
</div>
<div class="row row-img-full" style="background-image: url('http://gm-s3-qa.intridea.com/documents/attachments/000/000/016/original/contactpage-fullwidth.jpg?1442503695')">
  <div class="row-img-full-content">
    <div class="col-xs-12">
    </div>
  </div>
</div>

<%= content_for :javascripts do %>
  <%= javascript_tag do %>
    $(function(){
      <%# $(".contact-form").validate(); %>

      var dependentFields = [
        "Items purchased  (optional)",
        "Curriculum",
        "Description",
        "Curriculum",
        "Format",
        "Country",
        "State",
        "Curriculum",
        "Grade",
        "School or District Size",
        "Title 1",
        "Returning Customer",
        "Tax Exempt",
        "Tax Exempt ID",
        "Desired Dates",
        "Desired Training topic"
      ];

      var topicFieldMapping = {
        'Print or Bulk Orders': [
          { name: 'Country' },
          { name: 'State' },
          { name: 'Curriculum' },
          { name: 'Grade' },
          { name: 'School or District Size' },
          { name: 'Title 1' },
          { name: 'Returning Customer' },
          { name: 'Tax Exempt' },
          { name: 'Tax Exempt ID' },
        ],
        'General': [
          { name: 'Description', required: true }
        ],
        'Professional Development': [
          { name: 'Desired Dates' },
          { name: 'Desired Training topic' },
          { name: 'Description', required: true }
        ]
      }

      var supportFieldMapping = {
        "Order Support": [
          { name: "Items purchased" },
          { name: "Curriculum" },
          { name: "Description" }
        ],
        "Parent Support": [
          { name: "Curriculum" },
          { name: "Description" }
        ],
        "Content/Implementation Support": [
          { name: "Curriculum" },
          { name: "Description" }
        ],
        "Content Error": [
          { name: "Curriculum" },
          { name: "Format" }
        ],
        "Technical Support":[
          { name: "Description" }
        ]
      };

      $('select#topic').change(function(e){
        $('.dependent-field').addClass('hidden');
        var topic = $(this).val();
        var mapping = topicFieldMapping[topic];
        if (mapping) {
          toggleDependentFields(mapping);
          return;
        }
        if (topic == 'Support') {
          $("[data-name='Support Type']").removeClass('hidden');
        } else {
          $("[data-name='Support Type']").addClass('hidden');
        }
      });

      $('select#support_type').change(function(e){
        $('.dependent-field').not('[data-name="Support Type"]').addClass('hidden');
        var value = $(this).val();
        if(value) {
          var mapping = supportFieldMapping[value];
          toggleDependentFields(mapping);
        }
      });

      function toggleDependentFields(mapping) {
        _.each(mapping, function(m, i){
          $('[data-name="'+m.name+'"]').removeClass('hidden');
        });
      }

    });
  <% end %>
<% end %>
